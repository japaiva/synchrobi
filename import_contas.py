#!/usr/bin/env python
"""
Script para importar contas contábeis via terminal
Execute: python import_contas.py
"""

import os
import sys
import django
from pathlib import Path

# Adicionar o diretório do projeto ao Python path
BASE_DIR = Path(__file__).resolve().parent
sys.path.append(str(BASE_DIR))

# Configurar Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'synchrobi.settings')
django.setup()

from core.models import ContaContabil

def main():
    """Função principal de importação"""
    
    print("=== IMPORTADOR DE CONTAS CONTÁBEIS ===\n")
    
    # Lista de contas únicas (código, nome) - extraídas da planilha
    contas_dados = [
        ("010", "Grupo 010"),
        ("010.010", "Grupo 010.010"),
        ("010.010.01", "Revenda de Mercadoria"),
        ("010.010.02", "Receita de Serviços"),
        ("010.020", "Faturamento Frete"),
        ("020", "Grupo 020"),
        ("020.010", "Grupo 020.010"),
        ("020.010.01", "ICMS s/ Vendas"),
        ("020.010.02", "PIS s/ Vendas"),
        ("020.010.03", "COFINS s/ Vendas"),
        ("020.010.04", "ICMS ST s/ Vendas"),
        ("020.010.05", "ICMS DIFAL"),
        ("020.010.06", "ICMS DIFAL FECP"),
        ("020.010.07", "IPI s/ Vendas"),
        ("020.010.08", "ISS s/ Serviços"),
        ("020.010.09", "PIS s/ Serviços"),
        ("020.010.10", "COFINS s/ Serviços"),
        ("020.020", "Grupo 020.020"),
        ("020.020.01", "ICMS s/ Devoluções"),
        ("020.020.02", "PIS s/ Devoluções"),
        ("020.020.03", "COFINS s/ Devoluções"),
        ("020.020.04", "ICMS ST s/ Devoluções"),
        ("020.020.05", "IPI s/ Devoluções"),
        ("030", "Grupo 030"),
        ("030.010", "Grupo 030.010"),
        ("030.010.01", "Abatimento s/ Vendas"),
        ("030.010.02", "Desconto s/ Vendas"),
        ("030.020", "Grupo 030.020"),
        ("030.020.01", "Devoluções de Vendas"),
        ("040", "Grupo 040"),
        ("040.010", "Grupo 040.010"),
        ("040.010.01", "CMV - Custo Mercadoria"),
        ("040.010.02", "CMV - Frete s/ Compras"),
        ("040.010.03", "CMV - Impostos s/ Compras"),
        ("040.010.04", "CMV - Outras Despesas s/ Compras"),
        ("040.010.05", "CMV - Benefício Fiscal"),
        ("040.020", "Grupo 040.020"),
        ("040.020.01", "CSP - Custo Serviço Prestado"),
        ("050", "Grupo 050"),
        ("050.010", "Grupo 050.010"),
        ("050.010.01", "Pessoal"),
        ("050.010.02", "Material de Expediente"),
        ("050.010.03", "Material de Limpeza"),
        ("050.010.04", "Material de Segurança"),
        ("050.010.05", "Combustível e Lubrificantes"),
        ("050.010.06", "Material de Consumo"),
        ("050.010.07", "Uniformes"),
        ("050.010.08", "Copa e Cozinha"),
        ("050.010.09", "Brindes e Presentes"),
        ("050.010.10", "Manutenção e Reparo _ Veículos"),
        ("050.010.11", "Manutenção e Reparo _ Predial"),
        ("050.010.12", "Manutenção e Reparo _ Máquinas e Equipamentos"),
        ("050.010.13", "Manutenção e Reparo _ Móveis e Utensílios"),
        ("050.010.14", "Manutenção e Reparo _ Informática"),
        ("050.010.15", "Fretes e Carretos"),
        ("050.010.16", "Energia Elétrica"),
        ("050.010.17", "Telefone"),
        ("050.010.18", "Correios e Malotes"),
        ("050.010.19", "Água e Esgoto"),
        ("050.010.20", "Gás"),
        ("050.010.21", "Segurança e Vigilância"),
        ("050.010.22", "Despesas Prediais"),
        ("050.010.23", "Assinatura e Anuidade"),
        ("050.010.24", "Licenças"),
        ("050.010.25", "Serviços de Terceiros _ PJ"),
        ("050.010.26", "Serviços de Terceiros _ PF"),
        ("050.010.27", "Honorários _ Profissionais Liberais"),
        ("050.010.28", "Honorários _ Administradores"),
        ("050.010.29", "Locação de Bens Móveis"),
        ("050.010.30", "Locação de Bens Imóveis"),
        ("050.010.31", "Locação de Veículos"),
        ("050.010.32", "Locação de Software"),
        ("050.010.33", "Locação de Máquinas e Equipamentos"),
        ("050.010.34", "Seguros"),
        ("050.010.35", "Viagem e Estada"),
        ("050.010.36", "Condução"),
        ("050.010.37", "Representação e Entretenimento"),
        ("050.010.38", "Propaganda e Publicidade"),
        ("050.010.39", "Impostos e Taxas"),
        ("050.010.40", "IPVA"),
        ("050.010.41", "IPTU"),
        ("050.010.42", "Multas"),
        ("050.010.43", "Depreciação"),
        ("050.010.44", "Amortização"),
        ("050.010.45", "Outras Despesas Operacionais"),
        ("050.020", "Grupo 050.020"),
        ("050.020.01", "Provisão p/ Perdas (Estimadas)"),
        ("050.020.02", "Perdas c/ Clientes"),
        ("050.020.03", "Perdas c/ Estoques"),
        ("060", "Grupo 060"),
        ("060.010", "Grupo 060.010"),
        ("060.010.01", "Pessoal"),
        ("060.010.02", "Material de Expediente"),
        ("060.010.03", "Material de Limpeza"),
        ("060.010.04", "Material de Segurança"),
        ("060.010.05", "Combustível e Lubrificantes"),
        ("060.010.06", "Material de Consumo"),
        ("060.010.07", "Uniformes"),
        ("060.010.08", "Copa e Cozinha"),
        ("060.010.09", "Brindes e Presentes"),
        ("060.010.10", "Manutenção e Reparo _ Veículos"),
        ("060.010.11", "Manutenção e Reparo _ Predial"),
        ("060.010.12", "Manutenção e Reparo _ Máquinas e Equipamentos"),
        ("060.010.13", "Manutenção e Reparo _ Móveis e Utensílios"),
        ("060.010.14", "Manutenção e Reparo _ Informática"),
        ("060.010.15", "Fretes e Carretos"),
        ("060.010.16", "Energia Elétrica"),
        ("060.010.17", "Telefone"),
        ("060.010.18", "Correios e Malotes"),
        ("060.010.19", "Água e Esgoto"),
        ("060.010.20", "Gás"),
        ("060.010.21", "Segurança e Vigilância"),
        ("060.010.22", "Despesas Prediais"),
        ("060.010.23", "Assinatura e Anuidade"),
        ("060.010.24", "Licenças"),
        ("060.010.25", "Serviços de Terceiros _ PJ"),
        ("060.010.26", "Serviços de Terceiros _ PF"),
        ("060.010.27", "Honorários _ Profissionais Liberais"),
        ("060.010.28", "Honorários _ Administradores"),
        ("060.010.29", "Locação de Bens Móveis"),
        ("060.010.30", "Locação de Bens Imóveis"),
        ("060.010.31", "Locação de Veículos"),
        ("060.010.32", "Locação de Software"),
        ("060.010.33", "Locação de Máquinas e Equipamentos"),
        ("060.010.34", "Seguros"),
        ("060.010.35", "Viagem e Estada"),
        ("060.010.36", "Condução"),
        ("060.010.37", "Representação e Entretenimento"),
        ("060.010.38", "Propaganda e Publicidade"),
        ("060.010.39", "Impostos e Taxas"),
        ("060.010.40", "IPVA"),
        ("060.010.41", "IPTU"),
        ("060.010.42", "Multas"),
        ("060.010.43", "Depreciação"),
        ("060.010.44", "Amortização"),
        ("060.010.45", "Outras Despesas Operacionais"),
        ("070", "Grupo 070"),
        ("070.010", "Grupo 070.010"),
        ("070.010.01", "Pessoal"),
        ("070.010.02", "Material de Expediente"),
        ("070.010.03", "Material de Limpeza"),
        ("070.010.04", "Material de Segurança"),
        ("070.010.05", "Combustível e Lubrificantes"),
        ("070.010.06", "Material de Consumo"),
        ("070.010.07", "Uniformes"),
        ("070.010.08", "Copa e Cozinha"),
        ("070.010.09", "Brindes e Presentes"),
        ("070.010.10", "Manutenção e Reparo _ Veículos"),
        ("070.010.11", "Manutenção e Reparo _ Predial"),
        ("070.010.12", "Manutenção e Reparo _ Máquinas e Equipamentos"),
        ("070.010.13", "Manutenção e Reparo _ Móveis e Utensílios"),
        ("070.010.14", "Manutenção e Reparo _ Informática"),
        ("070.010.15", "Fretes e Carretos"),
        ("070.010.16", "Energia Elétrica"),
        ("070.010.17", "Telefone"),
        ("070.010.18", "Correios e Malotes"),
        ("070.010.19", "Água e Esgoto"),
        ("070.010.20", "Gás"),
        ("070.010.21", "Segurança e Vigilância"),
        ("070.010.22", "Despesas Prediais"),
        ("070.010.23", "Assinatura e Anuidade"),
        ("070.010.24", "Licenças"),
        ("070.010.25", "Serviços de Terceiros _ PJ"),
        ("070.010.26", "Serviços de Terceiros _ PF"),
        ("070.010.27", "Honorários _ Profissionais Liberais"),
        ("070.010.28", "Honorários _ Administradores"),
        ("070.010.29", "Locação de Bens Móveis"),
        ("070.010.30", "Locação de Bens Imóveis"),
        ("070.010.31", "Locação de Veículos"),
        ("070.010.32", "Locação de Software"),
        ("070.010.33", "Locação de Máquinas e Equipamentos"),
        ("070.010.34", "Seguros"),
        ("070.010.35", "Viagem e Estada"),
        ("070.010.36", "Condução"),
        ("070.010.37", "Representação e Entretenimento"),
        ("070.010.38", "Propaganda e Publicidade"),
        ("070.010.39", "Impostos e Taxas"),
        ("070.010.40", "IPVA"),
        ("070.010.41", "IPTU"),
        ("070.010.42", "Multas"),
        ("070.010.43", "Depreciação"),
        ("070.010.44", "Amortização"),
        ("070.010.45", "Outras Despesas Operacionais"),
        ("080", "Grupo 080"),
        ("080.010", "Grupo 080.010"),
        ("080.010.01", "Pessoal"),
        ("080.010.02", "Material de Expediente"),
        ("080.010.03", "Material de Limpeza"),
        ("080.010.04", "Material de Segurança"),
        ("080.010.05", "Combustível e Lubrificantes"),
        ("080.010.06", "Material de Consumo"),
        ("080.010.07", "Uniformes"),
        ("080.010.08", "Copa e Cozinha"),
        ("080.010.09", "Brindes e Presentes"),
        ("080.010.10", "Manutenção e Reparo _ Veículos"),
        ("080.010.11", "Manutenção e Reparo _ Predial"),
        ("080.010.12", "Manutenção e Reparo _ Máquinas e Equipamentos"),
        ("080.010.13", "Manutenção e Reparo _ Móveis e Utensílios"),
        ("080.010.14", "Manutenção e Reparo _ Informática"),
        ("080.010.15", "Fretes e Carretos"),
        ("080.010.16", "Energia Elétrica"),
        ("080.010.17", "Telefone"),
        ("080.010.18", "Correios e Malotes"),
        ("080.010.19", "Água e Esgoto"),
        ("080.010.20", "Gás"),
        ("080.010.21", "Segurança e Vigilância"),
        ("080.010.22", "Despesas Prediais"),
        ("080.010.23", "Assinatura e Anuidade"),
        ("080.010.24", "Licenças"),
        ("080.010.25", "Serviços de Terceiros _ PJ"),
        ("080.010.26", "Serviços de Terceiros _ PF"),
        ("080.010.27", "Honorários _ Profissionais Liberais"),
        ("080.010.28", "Honorários _ Administradores"),
        ("080.010.29", "Locação de Bens Móveis"),
        ("080.010.30", "Locação de Bens Imóveis"),
        ("080.010.31", "Locação de Veículos"),
        ("080.010.32", "Locação de Software"),
        ("080.010.33", "Locação de Máquinas e Equipamentos"),
        ("080.010.34", "Seguros"),
        ("080.010.35", "Viagem e Estada"),
        ("080.010.36", "Condução"),
        ("080.010.37", "Representação e Entretenimento"),
        ("080.010.38", "Propaganda e Publicidade"),
        ("080.010.39", "Impostos e Taxas"),
        ("080.010.40", "IPVA"),
        ("080.010.41", "IPTU"),
        ("080.010.42", "Multas"),
        ("080.010.43", "Depreciação"),
        ("080.010.44", "Amortização"),
        ("080.010.45", "Outras Despesas Operacionais"),
        ("090", "Grupo 090"),
        ("090.010", "Grupo 090.010"),
        ("090.010.01", "Pessoal"),
        ("090.010.02", "Material de Expediente"),
        ("090.010.03", "Material de Limpeza"),
        ("090.010.04", "Material de Segurança"),
        ("090.010.05", "Combustível e Lubrificantes"),
        ("090.010.06", "Material de Consumo"),
        ("090.010.07", "Uniformes"),
        ("090.010.08", "Copa e Cozinha"),
        ("090.010.09", "Brindes e Presentes"),
        ("090.010.10", "Manutenção e Reparo _ Veículos"),
        ("090.010.11", "Manutenção e Reparo _ Predial"),
        ("090.010.12", "Manutenção e Reparo _ Máquinas e Equipamentos"),
        ("090.010.13", "Manutenção e Reparo _ Móveis e Utensílios"),
        ("090.010.14", "Manutenção e Reparo _ Informática"),
        ("090.010.15", "Fretes e Carretos"),
        ("090.010.16", "Energia Elétrica"),
        ("090.010.17", "Telefone"),
        ("090.010.18", "Correios e Malotes"),
        ("090.010.19", "Água e Esgoto"),
        ("090.010.20", "Gás"),
        ("090.010.21", "Segurança e Vigilância"),
        ("090.010.22", "Despesas Prediais"),
        ("090.010.23", "Assinatura e Anuidade"),
        ("090.010.24", "Licenças"),
        ("090.010.25", "Serviços de Terceiros _ PJ"),
        ("090.010.26", "Serviços de Terceiros _ PF"),
        ("090.010.27", "Honorários _ Profissionais Liberais"),
        ("090.010.28", "Honorários _ Administradores"),
        ("090.010.29", "Locação de Bens Móveis"),
        ("090.010.30", "Locação de Bens Imóveis"),
        ("090.010.31", "Locação de Veículos"),
        ("090.010.32", "Locação de Software"),
        ("090.010.33", "Locação de Máquinas e Equipamentos"),
        ("090.010.34", "Seguros"),
        ("090.010.35", "Viagem e Estada"),
        ("090.010.36", "Condução"),
        ("090.010.37", "Representação e Entretenimento"),
        ("090.010.38", "Propaganda e Publicidade"),
        ("090.010.39", "Impostos e Taxas"),
        ("090.010.40", "IPVA"),
        ("090.010.41", "IPTU"),
        ("090.010.42", "Multas"),
        ("090.010.43", "Depreciação"),
        ("090.010.44", "Amortização"),
        ("090.010.45", "Outras Despesas Operacionais"),
        ("100", "Grupo 100"),
        ("100.010", "Grupo 100.010"),
        ("100.010.01", "Comissões"),
        ("100.010.02", "Desconto Concedido"),
        ("100.010.03", "Bonificação Concedida"),
        ("100.020", "Grupo 100.020"),
        ("100.020.01", "Propaganda e Publicidade"),
        ("100.020.02", "Promoção de Vendas"),
        ("100.020.03", "Feiras e Exposições"),
        ("100.020.04", "Marketing"),
        ("110", "Grupo 110"),
        ("110.010", "Grupo 110.010"),
        ("110.010.01", "Fretes s/ Vendas"),
        ("110.010.02", "Seguros s/ Vendas"),
        ("110.010.03", "Outras Despesas c/ Vendas"),
        ("120", "Grupo 120"),
        ("120.010", "Grupo 120.010"),
        ("120.010.01", "Pessoal"),
        ("120.010.02", "Material de Expediente"),
        ("120.010.03", "Material de Limpeza"),
        ("120.010.04", "Material de Segurança"),
        ("120.010.05", "Combustível e Lubrificantes"),
        ("120.010.06", "Material de Consumo"),
        ("120.010.07", "Uniformes"),
        ("120.010.08", "Copa e Cozinha"),
        ("120.010.09", "Brindes e Presentes"),
        ("120.010.10", "Manutenção e Reparo _ Veículos"),
        ("120.010.11", "Manutenção e Reparo _ Predial"),
        ("120.010.12", "Manutenção e Reparo _ Máquinas e Equipamentos"),
        ("120.010.13", "Manutenção e Reparo _ Móveis e Utensílios"),
        ("120.010.14", "Manutenção e Reparo _ Informática"),
        ("120.010.15", "Fretes e Carretos"),
        ("120.010.16", "Energia Elétrica"),
        ("120.010.17", "Telefone"),
        ("120.010.18", "Correios e Malotes"),
        ("120.010.19", "Água e Esgoto"),
        ("120.010.20", "Gás"),
        ("120.010.21", "Segurança e Vigilância"),
        ("120.010.22", "Despesas Prediais"),
        ("120.010.23", "Assinatura e Anuidade"),
        ("120.010.24", "Licenças"),
        ("120.010.25", "Serviços de Terceiros _ PJ"),
        ("120.010.26", "Serviços de Terceiros _ PF"),
        ("120.010.27", "Honorários _ Profissionais Liberais"),
        ("120.010.28", "Honorários _ Administradores"),
        ("120.010.29", "Locação de Bens Móveis"),
        ("120.010.30", "Locação de Bens Imóveis"),
        ("120.010.31", "Locação de Veículos"),
        ("120.010.32", "Locação de Software"),
        ("120.010.33", "Locação de Máquinas e Equipamentos"),
        ("120.010.34", "Seguros"),
        ("120.010.35", "Viagem e Estada"),
        ("120.010.36", "Condução"),
        ("120.010.37", "Representação e Entretenimento"),
        ("120.010.38", "Propaganda e Publicidade"),
        ("120.010.39", "Impostos e Taxas"),
        ("120.010.40", "IPVA"),
        ("120.010.41", "IPTU"),
        ("120.010.42", "Multas"),
        ("120.010.43", "Depreciação"),
        ("120.010.44", "Amortização"),
        ("120.010.45", "Outras Despesas Operacionais"),
        ("130", "Grupo 130"),
        ("130.010", "Grupo 130.010"),
        ("130.010.01", "Resultado na Venda de Imobilizado"),
        ("130.010.02", "Resultado na Venda de Investimentos"),
        ("130.010.03", "Resultado na Baixa de Imobilizado"),
        ("130.010.04", "Outras Receitas"),
        ("130.010.05", "Outras Despesas"),
        ("140", "Grupo 140"),
        ("140.010", "Grupo 140.010"),
        ("140.010.01", "Juros Ativos"),
        ("140.010.02", "Descontos Obtidos"),
        ("140.010.03", "Rendimentos s/ Aplicações"),
        ("140.010.04", "Variação Monetária Ativa"),
        ("140.010.05", "Variação Cambial Ativa"),
        ("140.010.06", "Outras Receitas Financeiras"),
        ("140.020", "Grupo 140.020"),
        ("140.020.01", "Equivalência Patrimonial Positiva"),
        ("140.020.02", "Equivalência Patrimonial Negativa"),
        ("160", "Grupo 160"),
        ("160.010", "Benefício Fiscal"),
        ("170", "Grupo 170"),
        ("170.010", "Despesas (Receitas) Não Operacionais"),
        ("170.020", "Expansão"),
        ("180", "Grupo 180"),
        ("180.010", "Despesas Financeiras _ Anos Anteriores"),
        ("180.020", "Despesas Financeiras _ do Exercício"),
        ("190", "Grupo 190"),
        ("190.010", "Receitas Financeiras"),
        ("210", "Grupo 210"),
        ("210.010", "IR / CSLL"),
        ("900", "Investimento"),
    ]
    
    print(f"Encontradas {len(contas_dados)} contas únicas para importar\n")
    
    # Confirmar antes de executar
    resposta = input("Deseja prosseguir com a importação? (s/N): ")
    if resposta.lower() not in ['s', 'sim', 'y', 'yes']:
        print("Importação cancelada.")
        return
    
    print("\nIniciando importação...\n")
    
    sucessos = 0
    erros = 0
    
    # Importar contas em ordem (pais primeiro, depois filhas)
    for codigo, nome in contas_dados:
        try:
            conta, created = ContaContabil.objects.get_or_create(
                codigo=codigo,
                defaults={
                    'nome': nome,
                    'ativa': True
                }
            )
            
            if created:
                print(f"  ✅ {codigo} - {nome}")
                sucessos += 1
            else:
                print(f"  ⭕ {codigo} - {nome} (já existe)")
                
        except Exception as e:
            print(f"  ❌ Erro em {codigo}: {e}")
            erros += 1
    
    # Relatório final
    print(f"\n=== RESULTADO ===")
    print(f"Sucessos: {sucessos}")
    print(f"Erros: {erros}")
    
    # Estatísticas
    total = ContaContabil.objects.count()
    sinteticos = sum(1 for c in ContaContabil.objects.all() if c.tem_subcontas)
    analiticos = total - sinteticos
    
    print(f"\n=== ESTATÍSTICAS ===")
    print(f"Total no banco: {total}")
    print(f"Sintéticos: {sinteticos}")
    print(f"Analíticos: {analiticos}")
    print("\nImportação concluída!")

if __name__ == "__main__":
    main()
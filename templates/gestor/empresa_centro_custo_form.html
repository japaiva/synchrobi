<!-- gestor/templates/gestor/empresa_centro_custo_form.html - Versão Simplificada -->
{% extends 'gestor/base_gestor.html' %}

{% block title %}{{ title }} | SynchroBI{% endblock %}

{% block content %}
<div class="card shadow">
  <div class="card-header bg-light d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">
      <i class="fas {% if is_create %}fa-plus-circle{% else %}fa-edit{% endif %} me-2"></i>
      {{ title }}
    </h5>
    <a href="{% if empresa %}{% url 'gestor:empresa_centro_custo_list' empresa.sigla %}{% else %}{% url 'gestor:empresa_centro_custo_list' %}{% endif %}" 
       class="btn btn-outline-secondary btn-sm">
      <i class="fas fa-arrow-left me-1"></i> Voltar
    </a>
  </div>
  
  <div class="card-body">
    <form method="post" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="alert alert-danger">
          {% for error in form.non_field_errors %}
            <p class="mb-0">{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- Informações Principais -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-light">
          <h6 class="card-title mb-0">
            <i class="fas fa-link me-2"></i>
            Dados do Relacionamento
          </h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <!-- Empresa -->
            <div class="col-md-6">
              <label for="{{ form.empresa.id_for_label }}" class="form-label">
                {{ form.empresa.label }} <span class="text-danger">*</span>
              </label>
              {{ form.empresa }}
              {% if form.empresa.errors %}
                <div class="text-danger small mt-1">
                  {% for error in form.empresa.errors %}{{ error }}{% endfor %}
                </div>
              {% endif %}
            </div>
            
            <!-- Centro de Custo -->
            <div class="col-md-6">
              <label for="{{ form.centro_custo.id_for_label }}" class="form-label">
                {{ form.centro_custo.label }} <span class="text-danger">*</span>
              </label>
              {{ form.centro_custo }}
              {% if form.centro_custo.errors %}
                <div class="text-danger small mt-1">
                  {% for error in form.centro_custo.errors %}{{ error }}{% endfor %}
                </div>
              {% endif %}
            </div>
            
            <!-- Responsável -->
            <div class="col-md-12">
              <label for="{{ form.responsavel.id_for_label }}" class="form-label">
                {{ form.responsavel.label }} <span class="text-danger">*</span>
              </label>
              {{ form.responsavel }}
              {% if form.responsavel.errors %}
                <div class="text-danger small mt-1">
                  {% for error in form.responsavel.errors %}{{ error }}{% endfor %}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      <!-- Observações e Status -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-light">
          <h6 class="card-title mb-0">
            <i class="fas fa-clipboard me-2"></i>
            Informações Complementares
          </h6>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <!-- Observações -->
            <div class="col-md-12">
              <label for="{{ form.observacoes.id_for_label }}" class="form-label">
                {{ form.observacoes.label }}
              </label>
              {{ form.observacoes }}
              {% if form.observacoes.errors %}
                <div class="text-danger small mt-1">
                  {% for error in form.observacoes.errors %}{{ error }}{% endfor %}
                </div>
              {% endif %}
            </div>
            
            <!-- Status Ativo -->
            <div class="col-md-12">
              <div class="card bg-light">
                <div class="card-body py-3">
                  <div class="form-check form-switch">
                    {{ form.ativo }}
                    <label class="form-check-label" for="{{ form.ativo.id_for_label }}">
                      <strong>{{ form.ativo.label }}</strong>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Botões de ação -->
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <a href="{% if empresa %}{% url 'gestor:empresa_centro_custo_list' empresa.sigla %}{% else %}{% url 'gestor:empresa_centro_custo_list' %}{% endif %}" 
             class="btn btn-outline-secondary me-2">
            <i class="fas fa-times me-1"></i> Cancelar
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-1"></i> 
            {% if is_create %}Criar Relacionamento{% else %}Salvar Alterações{% endif %}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const dataInicio = document.getElementById('{{ form.data_inicio.id_for_label }}');
    const dataFim = document.getElementById('{{ form.data_fim.id_for_label }}');
    const periodoPreview = document.getElementById('periodo-preview');
    
    function updatePeriodoPreview() {
        const inicio = dataInicio.value;
        const fim = dataFim.value;
        
        if (inicio) {
            const inicioFormatado = new Date(inicio).toLocaleDateString('pt-BR');
            if (fim) {
                const fimFormatado = new Date(fim).toLocaleDateString('pt-BR');
                periodoPreview.textContent = `${inicioFormatado} a ${fimFormatado}`;
            } else {
                periodoPreview.textContent = `Desde ${inicioFormatado}`;
            }
        } else {
            periodoPreview.textContent = 'Configure as datas acima';
        }
    }
    
    dataInicio.addEventListener('change', updatePeriodoPreview);
    dataFim.addEventListener('change', updatePeriodoPreview);
    
    // Atualizar na carga da página
    updatePeriodoPreview();
    
    // Validação de datas
    function validateDates() {
        const inicio = new Date(dataInicio.value);
        const fim = new Date(dataFim.value);
        
        if (dataInicio.value && dataFim.value && fim < inicio) {
            dataFim.setCustomValidity('Data de fim não pode ser anterior à data de início');
        } else {
            dataFim.setCustomValidity('');
        }
    }
    
    dataInicio.addEventListener('change', validateDates);
    dataFim.addEventListener('change', validateDates);
});
</script>
{% endblock %}